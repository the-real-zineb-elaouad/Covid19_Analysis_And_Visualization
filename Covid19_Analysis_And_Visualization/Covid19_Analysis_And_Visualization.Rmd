---
title: "projet"
output: html_document
date: "2025-04-08"
#runtime: shiny
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(ggplot2)
#library(gridExtra)
#library(scales)
#library(shiny)
```

To learn more, see [Interactive Documents](http://rmarkdown.rstudio.com/authoring_shiny.html).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

```{r}
CovidData <- read.csv("../data/owid-covid-data.csv", sep = ",")
CovidData %>% head(10)
```
# I/ Préparation et nettoyage des données
## 1. Vérification et convertions des types de variables
```{r}
str(CovidData)
```
### Conversion de la date et des variables catégorielles
```{r}
CovidData$date <- as.Date(CovidData$date)
CovidData$continent <- as.factor(CovidData$continent)
CovidData$location <- as.factor(CovidData$location)
CovidData$iso_code <- as.factor(CovidData$iso_code)
str(CovidData)

```
## 2. Suppression des colonnes avec plus de 90 % de valeurs manquantes
toutes les colonnes contenant plus de 90% de valeurs manquantes (NA) ont été retirées. Leurs noms sont conservés dans une variable colonnes_supprimees à des fins de traçabilité.
```{r}
na_ratio <- colMeans(is.na(CovidData))

colonnes_supprimees <- names(na_ratio[na_ratio > 0.9])

CovidData_clean <- CovidData[, !(names(CovidData) %in% colonnes_supprimees)]

colonnes_supprimees
```
## 3. Détection, traitement et suppression des doublons
### - Detectetion
#### Nous avons détecté 7 770 doublons sur la combinaison location + date. Ces doublons n'étaient pas de simples répétitions, mais souvent deux lignes contenant des données partielles. C'EST DES DONNEES FRAGMENTEES

```{r}
doublons <- duplicated(CovidData_clean[, c("date", "location")])
CovidData_clean[doublons, ]
```
```{r}
doublons <- CovidData_clean %>%
  filter(duplicated(select(., location, date)) | duplicated(select(., location, date), fromLast = TRUE))


doublons <- doublons %>% arrange(location, date)
doublons
```
### - Traitement des doublons
#### fusionné chaque groupe de doublons (location, date) en une seule ligne, en conservant Pour chaque colonne, la valeur non manquante (non-NA) si elle existe. Si les deux valeurs sont NA, le NA est conservé
```{r}
fusionnes <- doublons %>%
  group_by(location, date) %>%
  summarise(across(everything(), ~ first(na.omit(.))), .groups = "drop")
```

### - Suppression des doublons après fusion
#### Suppression des anciennes lignes doublées du jeu de données initial + Ajout des lignes fusionnées à leur place
```{r}
CovidData_sans_doublons <- CovidData_clean %>%
  filter(!(paste(location, date) %in% paste(doublons$location, doublons$date)))

CovidData_clean <- bind_rows(CovidData_sans_doublons, fusionnes) %>%
  arrange(location, date)

CovidData_clean
```

## 4. ReVérification des donees et Chargement dans CovidData_Prepared 
```{r}
str(CovidData_clean)
summary(CovidData_clean)
CovidData_Prepared <- CovidData_clean
```

# ++++++++++++++++++++++++++ FIN PREPARATION DES DONNEES +++++++++++++++++++++++++++++++

```{r}
ListeLocation <- CovidData_Prepared %>% select(location) %>% distinct()
ListeLocation
```

```{r}
continents <- c("Africa", "Asia", "Europe", "North America",
    "South America", "Oceania")

continents

```
```{r}
regions_agregats <- c(
    "World", "European Union (27)", 
    "High-income countries", "Low-income countries",
    "Lower-middle-income countries", "Upper-middle-income countries"
  )
regions_agregats
```

```{r}
territory_or_dependency <- c(
      "England", "Scotland", "Wales", "Northern Ireland", "Puerto Rico", 
      "Hong Kong", "Macao", "Greenland", "Guadeloupe", "Martinique", 
      "French Guiana", "French Polynesia", "Reunion", "Mayotte", "New Caledonia", 
      "Aruba", "Curacao", "Bonaire Sint Eustatius and Saba", "Gibraltar", 
      "Guernsey", "Jersey", "Isle of Man", "Faroe Islands", "Falkland Islands", 
      "Saint Martin (French part)", "Sint Maarten (Dutch part)", "Saint Barthelemy", 
      "Saint Pierre and Miquelon", "Cayman Islands", "Bermuda", "British Virgin Islands", 
      "United States Virgin Islands", "Turks and Caicos Islands", "Anguilla", 
      "Montserrat", "Cook Islands", "Tokelau", "Niue", "Pitcairn", "Western Sahara", 
      "Palestine", "Kosovo", "Northern Cyprus", "Taiwan", "Vatican", 
      "Micronesia (country)")

territory_or_dependency
```

```{r}
CovidData_Prepared <- CovidData_Prepared %>%
  mutate(type_location = case_when(
    location %in% continents ~ "continent",
    location %in% regions_agregats ~ "region_or_aggregate",
    location %in% territory_or_dependency ~ "territory_or_dependency",
    .default = "country"
  ))
CovidData_Prepared
```

```{r}
CovidData_Prepared %>% select(location, type_location) %>% distinct()
```


```{r}
CovidData_Prepared %>% filter(location == 'France')
```
# --------------------------------------------------------------------------------
### Nettoyage des colonnes communes inutilisés

```{r}
CovidDataClean <- CovidData %>% select(-iso_code, -new_cases_smoothed,-new_deaths_smoothed, -new_cases_smoothed_per_million, -new_deaths_smoothed_per_million, -new_tests_smoothed, -new_tests_smoothed_per_thousand, -new_vaccinations_smoothed, -new_vaccinations_smoothed_per_million, -new_people_vaccinated_smoothed, -new_people_vaccinated_smoothed_per_hundred)

CovidDataClean
```


### 
```{r}
df_evolution_temporelle <- CovidDataClean %>% select(continent, location, date, total_cases, new_cases, total_deaths, total_cases_per_million, new_cases_per_million, total_deaths_per_million, new_deaths_per_million, reproduction_rate, stringency_index, type_location)

df_evolution_temporelle
```

# --------------------------------------------------------------------------------


















## -----------------------------------------------------------------  SALAH -------------------------------------------------------------


## -----------------------------------------------------------------  SIAKA -------------------------------------------------------------


## -----------------------------------------------------------------  ZINEB -------------------------------------------------------------


## -----------------------------------------------------------------  SADOU -------------------------------------------------------------


## -----------------------------------------------------------------  ALIOU -------------------------------------------------------------
```{r}
world_data <- CovidData_Prepared %>%
  filter(location == "World") %>%
  select(date, new_cases_smoothed, new_deaths_smoothed)

ggplot(world_data, aes(x = date)) +
  geom_line(aes(y = new_cases_smoothed), color = "steelblue", size = 1.2) +
  geom_line(aes(y = new_deaths_smoothed), color = "red", size = 1, linetype = "dashed") +
  scale_x_date(
    date_breaks = "1 month",  # une graduation tous les mois
    date_labels = "%b %Y"     # format abrégé du mois + année (ex: Jan 2021)
  ) +
  labs(
    title = "Évolution mensuelle des cas et des décès COVID-19 dans le monde",
    subtitle = "Cas et décès lissés sur 7 jours",
    x = "Mois", y = "Nombre quotidien (moyenne mobile)",
    caption = "Source : Our World in Data"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # rotation des mois
```
```{r}
continent_data <- CovidData_Prepared %>%
  filter(!is.na(continent)) %>%
  group_by(continent, date) %>%
  summarise(new_cases = sum(new_cases_smoothed, na.rm = TRUE), .groups = "drop")

ggplot(continent_data, aes(x = date, y = new_cases)) +
  geom_line(color = "darkorange", size = 1) +
  facet_wrap(~continent, scales = "free_y") +
  labs(
    title = "Évolution des cas COVID-19 par continent",
    subtitle = "Nouveaux cas lissés (7 jours)",
    x = "Date", y = "Cas quotidiens",
    caption = "Source : Our World in Data"
  ) +
  theme_minimal()
```






## =============================================== FIN ================================================================


## Inputs and Outputs

You can embed Shiny inputs and outputs in your document. Outputs are automatically updated whenever inputs change.  This demonstrates how a standard R plot can be made interactive by wrapping it in the Shiny `renderPlot` function. The `selectInput` and `sliderInput` functions create the input widgets used to drive the plot.

```{r}
# Chargement des données OWID
Covid19 <- read_delim("./owid-covid-data.csv", delim = ",") %>%
  filter(location %in% c("France", "Germany", "Italy")) %>%
  filter(!is.na(total_cases), !is.na(total_deaths)) %>%
  mutate(date = as.Date(date))

 

```
```{r}
# Graphique 1 : Cas cumulés
p1 <- ggplot(Covid19, aes(x = date, y = total_cases, color = location)) +
  geom_line(size = 1) +
  scale_y_log10(labels = comma) +
  labs(title = "Cas cumulés (échelle logarithmique)", x = "Date", y = "Total cas", color = "Pays") +
  theme_minimal(base_size = 14)

# Graphique 2 : Décès cumulés
p2 <- ggplot(Covid19, aes(x = date, y = total_deaths, color = location)) +
  geom_line(size = 1) +
  scale_y_log10(labels = comma) +
  labs(title = "Décès cumulés (échelle logarithmique)", x = "Date", y = "Total décès", color = "Pays") +
  theme_minimal(base_size = 14)

# Afficher les deux côte à côte
grid.arrange(p1, p2, ncol = 2)



```
